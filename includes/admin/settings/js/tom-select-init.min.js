!function(t){"use strict";t(document).ready(function(){document.querySelectorAll(".ts_autocomplete").forEach(function(e){const o=e.getAttribute("data-wp-prefix")||"WZ",n=window[`${o}TomSelectSettings`]||WZTomSelectSettings,a=e.getAttribute("data-wp-action")||n.action,i=e.getAttribute("data-wp-nonce")||n.nonce,r=e.getAttribute("data-wp-endpoint")||n.endpoint,s=n.forms,c=n.tags,l=n.custom_fields,u=n.strings,d="forms"===r?s:"tags"===r?c:"custom_fields"===r?l:[];if(!d||!Array.isArray(d))return void console.error("Invalid options for endpoint:",r);const p=d.map(t=>({value:t.id,text:t.name})),g=e.value.split(",").map(t=>t.trim()).filter(Boolean);if(("category"===r||"post_tag"===r||r.includes("tax"))&&g.length>0){const t=g.map(t=>{const e=t.match(/^(.*)\s+\(.*:\d+\)$/);return{value:t,text:e?e[1]:t}}),e=[...p];t.forEach(t=>{e.some(e=>e.value===t.value)||e.push(t)}),p.length=0,p.push(...e)}let v={};const m=e.getAttribute("data-ts-config");if(m)try{v=JSON.parse(m),console.log("Parsed custom config:",v)}catch(t){console.error("Error parsing custom config:",m,t)}const f={...{plugins:["dropdown_input","clear_button","remove_button"],valueField:"value",labelField:"text",searchField:["text","value"],options:p,items:g,persist:!0,createOnBlur:!1,create:!1,render:{no_results:(t,e)=>`<div class="no-results">${u.no_results.replace("%s",e(t.input))}</div>`,option:(t,e)=>"category"===r||"post_tag"===r||r.includes("tax")?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`,item:(t,e)=>"category"===r||"post_tag"===r||r.includes("tax")?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`},load:function(e,o){e.length?t.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:a,nonce:i,q:e,endpoint:r},error:function(){o()},success:function(t){t.success&&Array.isArray(t.data)?o(t.data):o()}}):o()}},...v};console.log("Final config:",f);try{new TomSelect(e,f)}catch(t){console.error("Tom Select initialization error:",t)}})})}(jQuery);